<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FPS Auto-Lock PWA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Manifest gikan sa live server -->
<link rel="manifest" href="https://tunnelling-website.onrender.com/manifest.json">
<style>
body { margin:0; background:#000; font-family:Arial; color:#0f0; overflow:hidden; text-align:center; }
#hud { position: fixed; top:10px; left:10px; font-size:14px; }
#staminaBox { position: fixed; bottom:20px; left:50%; transform:translateX(-50%); width:200px; height:12px; border:1px solid #0f0; }
#stamina { height:100%; background:#0f0; }
button { font-size:20px; padding:15px 30px; margin:10px; background:#0f0; color:#000; border:none; cursor:pointer; }
button:hover { background:#0c0; }
canvas { display:block; }
</style>
</head>
<body>

<h1>FPS Auto-Lock PWA</h1>
<p>Installable Auto-Lock App</p>
<a id="downloadBtn"><button>Install App</button></a>

<div id="hud"></div>
<div id="staminaBox"><div id="stamina"></div></div>
<canvas id="game"></canvas>

<script>
// ===== PWA INSTALL PROMPT =====
let deferredPrompt;
const downloadBtn = document.getElementById('downloadBtn');
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  downloadBtn.style.display = 'inline-block';
});
downloadBtn.addEventListener('click', async () => {
  if(deferredPrompt){
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    if(choice.outcome === 'accepted') console.log('App installed');
    deferredPrompt = null;
  }
});

// ===== AUTO-LOCK FPS LOGIC =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let keys = {}, recoil = 0, time = 0;
let cx = canvas.width/2, cy = canvas.height/2;

const player = { x: cx, y: cy, vx:0, vy:0, accel:0.4, friction:0.85, walk:2.5, run:6, stamina:100, state:"IDLE" };
const enemy = { x:300, y:200, vx:1, vy:1, state:"PATROL", alive:true };

window.addEventListener("keydown", e=> keys[e.key]=true);
window.addEventListener("keyup", e=> keys[e.key]=false);

function update(dt){
  let moving=false;
  if(keys.w||keys.ArrowUp){player.vy-=player.accel; moving=true;}
  if(keys.s||keys.ArrowDown){player.vy+=player.accel; moving=true;}
  if(keys.a||keys.ArrowLeft){player.vx-=player.accel; moving=true;}
  if(keys.d||keys.ArrowRight){player.vx+=player.accel; moving=true;}

  let sprint = keys.Shift && player.stamina>0 && moving;
  let max = sprint ? player.run : player.walk;

  player.stamina += sprint?-0.4:0.2;
  player.stamina = Math.max(0, Math.min(100, player.stamina));

  player.vx = Math.max(-max, Math.min(max, player.vx));
  player.vy = Math.max(-max, Math.min(max, player.vy));
  player.x += player.vx;
  player.y += player.vy;
  player.vx *= player.friction;
  player.vy *= player.friction;
  player.x = Math.max(0, Math.min(canvas.width, player.x));
  player.y = Math.max(0, Math.min(canvas.height, player.y));

  let speed = Math.hypot(player.vx, player.vy);
  player.state = speed<0.3?"IDLE":(sprint?"SPRINTING":"WALKING");

  // Enemy AI
  let dist = Math.hypot(player.x - enemy.x, player.y - enemy.y);
  if(enemy.alive){
    if(dist<220 && player.state==="SPRINTING") enemy.state="CHASE";
    if(enemy.state==="PATROL"){
      enemy.x += enemy.vx; enemy.y += enemy.vy;
      if(Math.random()<0.01){enemy.vx*=-1; enemy.vy*=-1;}
    } else {
      enemy.x += (player.x - enemy.x)*0.02;
      enemy.y += (player.y - enemy.y)*0.02;
    }
  }

  // Auto-lock
  if(enemy.alive){
    let dx = enemy.x - player.x;
    let dy = enemy.y - player.y;
    cx += (dx - cx)/15;
    cy += (dy - cy)/15;
  }

  document.getElementById("hud").innerHTML =
    `PLAYER: ${player.state}<br>ENEMY: ${enemy.alive?enemy.state:"DOWN"}<br>AUTO-LOCK: ${enemy.alive?"ON":"OFF"}`;

  document.getElementById("stamina").style.width = player.stamina+"%";
}

function drawCrosshair(){
  let size = (player.state==="SPRINTING"?18:10)+recoil;
  ctx.strokeStyle="#0f0";
  ctx.beginPath();
  ctx.moveTo(cx-size,cy); ctx.lineTo(cx-3,cy);
  ctx.moveTo(cx+3,cy); ctx.lineTo(cx+size,cy);
  ctx.moveTo(cx,cy-size); ctx.lineTo(cx,cy-3);
  ctx.moveTo(cx,cy+3); ctx.lineTo(cx,cy+size);
  ctx.stroke();
}

function drawWeapon(){
  let sway = Math.sin(time/100)*(player.state==="SPRINTING"?10:4);
  ctx.fillStyle="#444";
  ctx.fillRect(cx+30+sway,canvas.height-90,160,45);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(enemy.alive){ ctx.fillStyle = enemy.state==="CHASE"?"red":"#555"; ctx.fillRect(enemy.x-15, enemy.y-15, 30, 30); }
  drawCrosshair();
  drawWeapon();
}

let last = performance.now();
function loop(t){
  time += t-last;
  let dt = t-last; last = t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop(last);

// Register Service Worker gikan sa live server
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('https://tunnelling-website.onrender.com/sw.js')
  .then(()=>console.log('Service Worker Registered'))
  .catch(err => console.log('SW Error:', err));
}
</script>
</body>
</html>
