<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Standalone PWA Screen Recorder</title>

  <!-- Inline Manifest -->
  <link rel="manifest" href='data:application/json,{"name":"My PWA","short_name":"PWAApp","start_url":"/","display":"standalone","background_color":"#ffffff","theme_color":"#007BFF","icons":[{"src":"data:image/png;base64,iVBORw0KGgoAAAANS...","sizes":"192x192","type":"image/png"},{"src":"data:image/png;base64,iVBORw0KGgoAAAANS...","sizes":"512x512","type":"image/png"}]}'>
  <meta name="theme-color" content="#007BFF">
</head>
<body>
  <header>
    <h1>Welcome to My PWA App!</h1>
  </header>

  <main>
    <p>This is a Progressive Web App ready to install and record screen.</p>
  </main>

  <button id="installBtn" style="display:none; padding:10px 20px;">Install App</button>
  <button id="recordBtn" style="padding:10px 20px;">Start Screen Recording</button>

  <script>
    // Inline Service Worker
    const swCode = `
      const CACHE_NAME = 'pwa-cache-v1';
      const urlsToCache = ['/'];
      self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(urlsToCache))));
      self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))));
    `;
    const swBlob = new Blob([swCode], {type: 'application/javascript'});
    navigator.serviceWorker.register(URL.createObjectURL(swBlob));

    // Install prompt
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
      installBtn.onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(c => deferredPrompt = null);
        installBtn.style.display = 'none';
      };
    });

    // Screen Recorder
    document.getElementById('recordBtn').onclick = async () => {
      try {
        if(document.documentElement.requestFullscreen) await document.documentElement.requestFullscreen();
        const stream = await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"}, audio:true});
        const recorder = new MediaRecorder(stream);
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
          const blob = new Blob(chunks,{type:'video/webm'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href=url; a.download='recording.webm'; a.click();
        };
        recorder.start();
        setTimeout(()=>recorder.stop(),15000);
      } catch(e){console.error(e);}
    };
  </script>
</body>
</html>
